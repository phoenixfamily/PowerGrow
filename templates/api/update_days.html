{% extends 'api/base.html' %}
{% block title %}ویرایش روز دوره  | PowerGrow{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="card shadow rounded-4 p-4">
        <h4 class="fw-bold mb-4 text-center">ویرایش روز دوره</h4>
        <form id="update-days-form">
            <div class="row g-3">
                <!-- انتخاب جلسه -->
                <div class="col-md-6">
                    <label for="session" class="form-label fw-semibold">جلسه</label>
                    <select class="form-select rounded-3" id="session" required>
                        {% for s in sessions %}
                            <option value="{{ s.id }}" {% if s.id == day.session.id %}selected{% endif %}>
                                {{ s.course.title }} | {{ s.number }} جلسه
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- انتخاب روزهای هفته -->
                <div class="col-md-6">
                    <label for="days" class="form-label fw-semibold">روزهای هفته</label>
                    <select multiple class="form-select rounded-3" id="days" required>
                        {% for val, name in DAY_CHOICES %}
                            <option value="{{ val }}" {% if val in day.days %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- فعال بودن -->
                <div class="col-md-6">
                    <label class="form-label fw-semibold">فعال</label>
                    <input type="checkbox" id="active" {% if day.active %}checked{% endif %}>
                </div>

                <!-- شهریه -->
                <div class="col-md-6">
                    <label for="tuition" class="form-label fw-semibold">شهریه</label>
                    <input type="number" class="form-control rounded-3" id="tuition" value="{{ day.tuition }}" required>
                </div>

                <!-- تخفیف -->
                <div class="col-md-6">
                    <label for="off" class="form-label fw-semibold">تخفیف</label>
                    <input type="number" class="form-control rounded-3" id="off" value="{{ day.off }}">
                </div>
            </div>
        </form>

        <div class="mt-3 text-center">
            <button id="submit" class="btn btn-cta">ذخیره تغییرات</button>
        </div>
    </div>
</div>

<script>
document.getElementById('submit').addEventListener('click', function(e) {
    e.preventDefault();
    const data = {
        session: document.getElementById('session').value,
        days: Array.from(document.getElementById('days').selectedOptions).map(o => o.value),
        active: document.getElementById('active').checked,
        tuition: document.getElementById('tuition').value,
        off: document.getElementById('off').value
    };

    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

    fetch("{% url 'product:manager-update-day' day.id %}", {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify(data)
    })
    .then(res => {
        if(res.ok){
            alert('اطلاعات با موفقیت بروزرسانی شد!');
            window.location.reload();
        } else {
            return res.json().then(err => alert('خطا: ' + JSON.stringify(err)));
        }
    })
    .catch(err => console.error(err));
});
</script>
{% endblock %}
