{% extends 'api/base.html' %}
{% block title %}ویرایش جلسه | PowerGrow{% endblock %}

{% block content %}
    <div class="container py-5">
        <div class="card shadow rounded-4 p-4">
            <h4 class="fw-bold mb-4 text-center">ویرایش جلسه</h4>
            <form id="update-session-form">
                <div class="row g-3">

                    <!-- شماره جلسه -->
                    <div class="col-md-6">
                        <label for="number" class="form-label fw-semibold">شماره جلسه</label>
                        <input type="number" class="form-control rounded-3" id="number" value="{{ session.number }}"
                               required>
                    </div>


                    <!-- دوره -->
                    <div class="col-md-6">
                        <label for="course" class="form-label fw-semibold">دوره مرتبط</label>
                        <select class="form-select rounded-3" id="course" required>
                            {% for c in courses %}
                                <option value="{{ c.id }}"
                                        {% if session.course.id == c.id %}selected{% endif %}>{{ c.title }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- فعال بودن جلسه -->
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">فعال</label>
                        <input type="checkbox" id="active" {% if session.active %}checked{% endif %}>
                    </div>

                </div>
            </form>

            <div class="d-flex justify-content-end mt-4">
                <button id="submit" class="btn btn-cta">بروزرسانی جلسه</button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('submit').addEventListener('click', function (e) {
            e.preventDefault();
            const data = {
                number: document.getElementById('number').value,
                course: document.getElementById('course').value,
                active: document.getElementById('active').checked
            };

            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

            fetch(`{% url 'product:manager-update-session' session.id %}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(result => {
                    alert('جلسه با موفقیت بروزرسانی شد!');
                    console.log(result);
                })
                .catch(err => {
                    console.error(err);
                    alert('خطا در بروزرسانی جلسه');
                });
        });
    </script>
{% endblock %}
