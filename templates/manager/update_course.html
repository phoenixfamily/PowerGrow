{% extends 'manager/base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="fa">
<head>
    {% block title %}بروزرسانی دوره{% endblock %}

</head>

<body>

{% block header %}
    <div class="d-flex justify-content-end my-3 me-3">
        <a href="#" id="submit" class="btn btn-cta">بروزرسانی</a>
    </div>
{% endblock %}


{% block content %}

    <div class="container mt-5">
        <form id="update-course-form">
            {% csrf_token %}
            <div class="form-group">
                <label for="title">:عنوان</label>
                <input type="text" class="form-control" id="title" name="title" value="{{ course.title }}" required>
            </div>

            <div class="form-group">
                <label for="name">:نام مربی</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ course.name }}" required>
            </div>

        <div class="form-group">
                <label for="time">:زمان</label>
                <input type="text" class="form-control" id="time" name="time" value="{{ course.time }}" required>
            </div>

            <div class="form-group">
                <label for="type">:نوع</label>
            <select class="form-control" id="type" name="type" required>
                <option value="public" {% if course.type == "public" %}selected{% endif %}>عمومی</option>
                <option value="private" {% if course.type == "private" %}selected{% endif %}>خصوصی</option>
                <option value="semi_private" {% if course.type == "semi_private" %}selected{% endif %}>نیمه خصوصی</option>  <!-- گزینه جدید -->
            </select>
            </div>

            <div class="form-group">
                <label for="description">:توضیحات</label>
                <textarea class="form-control" id="description" name="description">{{ course.description }}</textarea>
            </div>

            <div class="form-group">
                <label for="image">:تصویر</label>
                <input type="file" class="form-control" id="image" name="image">
            </div>

            <div class="form-group">
                <input type="checkbox" id="selected" name="selected" {% if course.selected %}checked{% endif %}>
                <label for="selected">:منتخب</label>
            </div>

            <div class="form-group">
                <label for="capacity">:ظرفیت</label>
                <input type="number" class="form-control" id="capacity" name="capacity" value="{{ course.capacity }}">
            </div>

            <div class="form-group">
                <label for="gender">:جنسیت</label>
                <select class="form-control" id="gender" name="gender">
                    <option value="male" {% if course.gender == "male" %}selected{% endif %}>مرد</option>
                    <option value="female" {% if course.gender == "female" %}selected{% endif %}>زن</option>
                </select>
            </div>

            <div class="form-group">
                <label for="active">:فعال</label>
                <input type="checkbox" id="active" name="active" {% if course.active %}checked{% endif %}>
            </div>

         <div class="form-group">
                <label for="previous">:پیش ثبت نام</label>
                <input type="checkbox" id="previous" name="previous" {% if course.previous %}checked{% endif %}>
            </div>
        </form>
    </div>

<script>
document.getElementById('submit').addEventListener('click', function(event) {
    event.preventDefault();

    const formData = new FormData();
    formData.append('title', document.getElementById('title').value);
    formData.append('name', document.getElementById('name').value);
    formData.append('type', document.getElementById('type').value);
    formData.append('time', document.getElementById('time').value);
    formData.append('description', document.getElementById('description').value);
    formData.append('selected', document.getElementById('selected').checked);
    formData.append('gender', document.getElementById('gender').value);
    formData.append('capacity', document.getElementById('capacity').value);
    formData.append('active', document.getElementById('active').checked);
    formData.append('previous', document.getElementById('previous').checked);

    const imageInput = document.getElementById('image');
    if (imageInput.files.length > 0) {
        formData.append('image', imageInput.files[0]);
    }

    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    fetch(`{% url 'product:manager-update-course' course.id %}`, {
        method: 'PATCH',
        headers: {
            'X-CSRFToken': csrfToken,
        },
        body: formData,
    })
    .then(response => {
        if (response.ok) {
            alert('اطلاعات با موفقیت به‌روزرسانی شد!');
        } else {
            return response.json().then(errorData => {
                alert('خطا: ' + JSON.stringify(errorData));
            });
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

</script>

{% endblock %}

</body>
</html>
