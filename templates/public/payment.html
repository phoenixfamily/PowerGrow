{% load static %}
<!doctype html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token }}">

    <title>ØªØ§ÛŒÛŒØ¯ÛŒÙ‡ Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø§Ø´Ú¯Ø§Ù‡ ÙˆØ±Ø²Ø´ÛŒ Ø­Ø¬Ø§Ø¨</title>

    {% load bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}


    <style>

        @font-face {
            font-family: BYekan;
            font-style: normal;
            font-weight: normal;
            src: url("/static/fonts/BYekan.eot");/* IE9 Compat Modes */
            src: url("/static/fonts/BYekan.woff") format('woff'),
            url("/static/fonts/BYekan.woff") format('woff2'), /* Super Modern Browsers */ url("/static/fonts/BYekan.ttf") format('truetype') /* Safari, Android, iOS */
        }

        .bg-light {
            background-color: #fdfdfd !important;
        }

        .shadow {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08) !important;
        }

        .btn-success {
            background-color: #E16539;
            border-color: #E16539;
            font-size: 18px;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .btn-success:hover {
            background-color: #c74e2d;
            border-color: #c74e2d;
        }


    </style>

</head>

<body>


<section class="py-5 bg-light">
    <div class="container px-4 px-lg-5">
        <div class="bg-white shadow rounded p-4">
            <h3 class="fw-bold mb-4 text-center">ØªØ£ÛŒÛŒØ¯ Ø«Ø¨Øª â€ŒÙ†Ø§Ù… Ø¯ÙˆØ±Ù‡</h3>

            <div class="row mb-4">
                <div class="col-md-6 mb-3">
                    <strong>Ù†Ø§Ù… Ø¯ÙˆØ±Ù‡:</strong> {{ product.title }}
                </div>
                <div class="col-md-6 mb-3">
                    <strong>Ù†Ø§Ù… Ù…Ø±Ø¨ÛŒ:</strong> {{ product.name }}
                </div>
                <div class="col-md-6 mb-3">
                    <strong>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹:</strong> {{ start }}
                </div>
                <div class="col-md-6 mb-3">
                    <strong>Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ:</strong> {{ day.title }}
                </div>
                <div class="col-md-6 mb-3">
                    <strong>ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª:</strong> {{ session }} Ø¬Ù„Ø³Ù‡
                </div>
                <div class="col-md-6 mb-3">
                    <strong>Ø³Ø§Ø¹Øª:</strong> {{ product.time }}
                </div>
                <div class="col-md-6 mb-3">
                    <strong>Ù‚ÛŒÙ…Øª:</strong> {{ day.tuition }} ØªÙˆÙ…Ø§Ù†
                </div>
                <div class="col-md-6 mb-3">
                    <strong>ØªØ®ÙÛŒÙ:</strong> {{ day.off }} %
                </div>
                <div class="col-md-12 mb-4">
                    <hr>
                    <h5 class="text-end">ğŸ’° Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ: <span id="final" class="text-success fw-bold"></span>
                    </h5>
                </div>
            </div>

            <div class="mt-4">
                <div class="border p-3 mb-3"
                     style="max-height: 200px; overflow-y: auto; text-align: right; font-size: 14px;">
                    <p>â€¢ Ø«Ø¨Øª Ù†Ø§Ù… Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø¯Ø± Ù…Ø¬Ù…ÙˆØ¹Ù‡ ÙˆØ±Ø²Ø´ÛŒ Ø­Ø¬Ø§Ø¨ Ø¨Ù‡ Ù…Ø¹Ù†Ø§ÛŒ Ù‚Ø¨ÙˆÙ„ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù…ÛŒ Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ù…Ù‚Ø±Ø±Ø§Øª Ø§ÛŒÙ† Ù…Ø¬Ù…ÙˆØ¹Ù‡
                        Ø§Ø³Øª.</p>
                    <p>â€¢ Ø§Ø² Ù¾Ø°ÛŒØ±Ø´ ÙˆØ§Ù„Ø¯ÛŒÙ† Ø¯Ø§Ø®Ù„ Ú©Ù„Ø§Ø³ Ù‡Ø§ Ù…Ø¹Ø°ÙˆØ±ÛŒÙ….</p>
                    <p>â€¢ Ø¨Ø¹Ø¯ Ø§Ø² Ø«Ø¨Øª Ù†Ø§Ù… ÙˆØ±Ø²Ø´Ú©Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¯Ø± ØªÙ…Ø§Ù…ÛŒ Ø¬Ù„Ø³Ø§Øª Ø­Ø¶ÙˆØ± Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯. Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ±ØŒ Ø¢Ù† Ø¬Ù„Ø³Ù‡ Ø³ÙˆØ®Øª
                        Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ù…Ú¯Ø± Ø§ÛŒÙ†Ú©Ù‡ Ú¯ÙˆØ§Ù‡ÛŒ Ù¾Ø²Ø´Ú© Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ Ú©Ù‡ Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ø¨Ù‡ Ø¯ÙØªØ± Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡Ø¯ ØªØ§ Ø³ÙˆØ®Øª
                        Ù†Ø´ÙˆØ¯. Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± Ø¯Ø± Ù‡Ø± Ø¯ÙˆØ±Ù‡â€ŒÛŒ Ø«Ø¨Øª Ù†Ø§Ù…ÛŒ Ø§Ù…Ú©Ø§Ù† Ù¾Ø°ÛŒØ± Ø§Ø³Øª).</p>
                    <p>â€¢ Ø¨ÛŒÙ…Ù‡ ÙˆØ±Ø²Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÙØ±Ø§Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù‡ÛŒÚ†â€ŒÚ¯ÙˆÙ†Ù‡ Ù…Ø³Ø¦ÙˆÙ„ÛŒØªÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø®ØµÙˆØµ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ù†Ø¯Ø§Ø±Ø¯.</p>
                    <p>â€¢ Ø¯Ø± Ø¨ÛŒÙ…Ù‡ ÙˆØ±Ø²Ø´ÛŒ Ø§Ø³Ù… Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø­Ø¬Ø§Ø¨ Ø´Ù…Ø§Ù„ ØºØ±Ø¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯.</p>
                    <p>â€¢ Ù…ÙˆÙ‚Ø¹ Ø«Ø¨Øª Ù†Ø§Ù… Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª Ø¯Ù‚Øª ÙØ±Ù…Ø§ÛŒÛŒØ¯. Ù‚Ø§Ø¨Ù„ ØªØºÛŒÛŒØ± Ù†ÛŒØ³Øª: Û¸ Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ (Ø¯Ùˆ Ø±ÙˆØ² Ø¯Ø± Ù‡ÙØªÙ‡) Ùˆ
                        Û±Û² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ (Û³ Ø±ÙˆØ² Ø¯Ø± Ù‡ÙØªÙ‡).</p>
                    <p>â€¢ Ø¯Ø± Û¸ Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø­ØªÙ…Ø§ Ø¨Ø§ÛŒØ¯ Ù…Ø´Ø®Øµ ÙØ±Ù…Ø§ÛŒÛŒØ¯ Ú©Ù‡ Ú©Ø¯Ø§Ù… Ø¯Ùˆ Ø±ÙˆØ² Ù‡ÙØªÙ‡ Ø§Ø² Ø¢Ù† Ú©Ù„Ø§Ø³ Ø±Ø§ ØªØ´Ø±ÛŒÙ Ù…ÛŒâ€ŒØ¢ÙˆØ±ÛŒØ¯.</p>
                    <p>â€¢ Ú©Ù†Ø³Ù„ Ú©Ø±Ø¯Ù† Ø¨Ø¹Ø¯ Ø§Ø² Ú¯Ø°Ø´Øª Û² Ø¬Ù„Ø³Ù‡ Ø§Ø² Ú©Ù„Ø§Ø³ Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ù†ÛŒØ³Øª Ùˆ Ù‡Ø²ÛŒÙ†Ù‡ Ø¹ÙˆØ¯Øª Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
                    <p>â€¢ Ú©Ù†Ø³Ù„ Ú©Ø±Ø¯Ù† Ùˆ Ø¹ÙˆØ¯Øª ÙˆØ¬Ù‡ Ø·Ø¨Ù‚ Ø´Ø±Ø§ÛŒØ·ÛŒ Ú©Ù‡ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø§Ø¹Ù„Ø§Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø¨Ø§ Ú©Ø³Ø± ØªÚ© Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ùˆ Ú©Ø³Ø± Ù…Ø§Ù„ÛŒØ§Øª ØªØ§ Ú†Ù†Ø¯
                        Ø³Ø§Ø¹Øª Ù‚Ø¨Ù„ Ø§Ø² Ø´Ø±ÙˆØ¹ Ø¬Ù„Ø³Ù‡ Ø³ÙˆÙ… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯ Ùˆ Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³Øª.</p>
                    <p>â€¢ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¹ÙˆØ¯Øª ÙˆØ¬Ù‡ ÙÙ‚Ø· Ø¨Ø§ Ù¾Ø± Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø¢Ù† Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³Øª Ùˆ Ù…Ø¨Ù„Øº Ø·ÛŒ Û· ØªØ§ Û±Û° Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ ÙˆØ§Ø±ÛŒØ² Ø®ÙˆØ§Ù‡Ø¯
                        Ø´Ø¯.</p>
                </div>

                <div class="form-check text-start mb-4">
                    <input class="form-check-input" type="checkbox" id="acceptRules"
                           style="position: relative; left: 0;">
                    <label class="form-check-label" for="acceptRules">
                        Ù‚ÙˆØ§Ù†ÛŒÙ† ÙÙˆÙ‚ Ø±Ø§ Ø®ÙˆØ§Ù†Ø¯Ù‡â€ŒØ§Ù… Ùˆ Ù‚Ø¨ÙˆÙ„ Ø¯Ø§Ø±Ù…
                    </label>
                </div>
            </div>


            <div class="text-center">
                <button id="registerButton" type="submit" class="btn btn-success px-5 py-2 fw-bold">
                    Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª
                </button>
            </div>
        </div>

    </div>
    </div>
</section>


<script>
    let off = "{{ day.off }}";
    let price = "{{ day.tuition }}";
    let day = "{{ day.id }}";
    let session = "{{ session.id }}";
    let course = "{{ product.id }}";
    let start = "{{ start.id }}";
    let final = document.getElementById("final");
    const registerButton = document.getElementById("registerButton");
    const acceptRules = document.getElementById("acceptRules");


    let final_price = (parseInt(price) - (parseInt(off) / 100 * parseInt(price)));
    final.innerHTML = final_price + " ØªÙˆÙ…Ø§Ù†";

    if (registerButton) {
        registerButton.addEventListener("click", function () {
            register();
        });
    } else {
        console.error("Register button not found.");
    }

    async function register() {

        if (!acceptRules.checked) {
            alert("Ù„Ø·ÙØ§ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ùˆ ØªØ§ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯.");
            return;
        }
        // Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù†ØµØ± final
        if (!final) {
            console.error("Final element not found.");
            return; // Ø®Ø±ÙˆØ¬ Ø§Ø² ØªØ§Ø¨Ø¹ Ø§Ú¯Ø± Ø¹Ù†ØµØ± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
        }

        const param = {
            "day": parseInt(day),
            "session": parseInt(session),
            "course": parseInt(course),
            "price": final_price,
            "startDay": parseInt(start),
            "description": "Ø´Ø±Ú©Øª Ø¯Ø± Ø¯ÙˆØ±Ù‡ Ù‡Ø§ÛŒ Ø¨Ø§Ø´Ú¯Ø§Ù‡ ÙˆØ±Ø²Ø´ÛŒ Ø­Ø¬Ø§Ø¨",
        };

        const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

        try {
            const response = await fetch("{% url 'product:create-participation' %}", {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
                body: JSON.stringify(param),
            });

            const result = await response.json();
            if (response.ok) {
                window.location.replace(result.payment + result.authority);
            } else {
                alert(`Error: ${response.status} - ${result.message || response.statusText}`);
            }
        } catch (error) {
            console.error('Error during registration:', error);
            alert('There was an error while processing your request.');
        }
    }
</script>

</body>
</html>