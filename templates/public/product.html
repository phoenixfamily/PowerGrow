{% extends 'public/base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="fa">
<head>
    {% block title %}Ø¯ÙˆØ±Ù‡ {{ product.title }} Ø¨Ø§Ø´Ú¯Ø§Ù‡ ÙˆØ±Ø²Ø´ÛŒ Ø­Ø¬Ø§Ø¨ {% endblock %}
</head>
<body>

{% block header %}
    <!-- Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ùˆ -->
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
            <li class="nav-item">
                <a class="nav-link" href="{% url 'home:home-view' %}">Ø®Ø§Ù†Ù‡</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="{% url 'product:sport-view' %}">Ø¯ÙˆØ±Ù‡ Ù‡Ø§</a>
            </li>

            <li class="nav-item">
                <a class="nav-link disabled" href="{% url 'reservation:reservation-view' %}">Ø±Ø²Ø±Ùˆ Ø³Ø§Ù„Ù†</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'about:about-view' %}">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'user:login' %}">ÙˆØ±ÙˆØ¯ Ùˆ Ø¹Ø¶ÙˆÛŒØª</a>
            </li>
        </ul>
    </div>
{% endblock %}



{% block content %}
    <section class="hero-split py-5">
        <div class="container-fluid px-lg-5">
            <div class="row g-5 align-items-stretch">

                <!-- Ù…ØªÙ† Ø³Ù…Øª Ø±Ø§Ø³Øª -->
                <div class="col-lg-6 d-flex">
                    <div class="ground-box text-white rounded p-4 w-100 d-flex flex-column justify-content-center">
                        <h2 class="fw-bold mb-4">{{ product.title }}</h2>

                        <div class="d-flex flex-column gap-4">

                            <div class="d-flex gap-3 align-items-start">
                                <i class="fa fa-calendar-check fa-2x"></i>
                                <div>
                                    <h5 class="mb-1">Ù†ÙˆØ¹ Ø¯ÙˆØ±Ù‡</h5>
                                    <p class="mb-0 small text-white ">
                                        {% if product.type == "public" %}
                                            Ø¹Ù…ÙˆÙ…ÛŒ
                                        {% elif product.type == "private" %}
                                            Ø®ØµÙˆØµÛŒ
                                        {% elif product.type == "semi_private" %}
                                            Ù†ÛŒÙ…Ù‡ Ø®ØµÙˆØµÛŒ
                                        {% endif %}
                                    </p>
                                </div>
                            </div>

                            <div class="d-flex gap-3 align-items-start">
                                <i class="fa fa-clock fa-2x"></i>
                                <div>
                                    <h5 class="mb-1">Ø²Ù…Ø§Ù† Ø¯ÙˆØ±Ù‡</h5>
                                    <p class="mb-0 small text-white ">{{ product.time }}</p>
                                </div>
                            </div>

                            <div class="d-flex gap-3 align-items-start">
                                <i class="fa fa-calendar-check fa-2x"></i>
                                <div>
                                    <h5 class="mb-1">Ø¬Ù†Ø³Ø¨Øª Ø¯ÙˆØ±Ù‡</h5>
                                    <p class="mb-0 small text-white ">
                                        {% if product.gender == "male" %}
                                            Ø¢Ù‚Ø§ÛŒØ§Ù†
                                        {% elif product.gender == "female" %}
                                            Ø¨Ø§Ù†ÙˆØ§Ù†
                                        {% endif %}
                                    </p>
                                </div>
                            </div>

                            <div class="d-flex gap-3 align-items-start">
                                <i class="fa fa-user-tie fa-2x"></i>
                                <div>
                                    <h5 class="mb-1">Ù…Ø±Ø¨ÛŒ</h5>
                                    <p class="mb-0 small text-white ">{{ product.name }}</p>
                                </div>
                            </div>

                            <div class="d-flex gap-3 align-items-start">
                                <i class="fa fa-users fa-2x"></i>
                                <div>
                                    <h5 class="mb-1">Ø¸Ø±ÙÛŒØª Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡</h5>
                                    <p class="mb-0 small text-white ">3 Ù†ÙØ±</p>
                                </div>
                            </div>

                            <div class="d-flex gap-3 align-items-start">
                                <i class="fa fa-money-bill-wave fa-2x"></i>
                                <div>
                                    <h5 class="mb-1">Ø´Ù‡Ø±ÛŒÙ‡</h5>
                                    <p class="mb-0 small text-white ">-</p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Ø¹Ú©Ø³ Ø³Ù…Øª Ú†Ù¾ -->
                <div class="col-lg-6 d-flex">
                    <div class="img-wrapper w-100 d-flex align-items-center justify-content-center">
                        <img src="{% static 'images/hero.png' %}" alt="Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ø¨Ø§Ù†ÙˆØ§Ù†" class="img-fluid rounded shadow">
                    </div>
                </div>

            </div>
        </div>
    </section>

    <section class="hero-split py-5">
        <div class="container-fluid px-lg-5">
            <div class="row d-flex flex-lg-row align-items-stretch">

                <div class="col-lg-3 d-flex justify-content-center align-items-center mt-4 mt-lg-0">
                    <a id="registerBtn" class="register-btn my-2">
                        <span>Ø«Ø¨Øª Ù†Ø§Ù…</span>
                        <i class="fa fa-arrow-left next-icon rtl"></i>
                    </a>
                </div>

                <div class="col-lg-9">

                    <div class="course-schedule-form bg-white p-4 rounded shadow-sm h-100">
                        <h4 class="fw-bold mb-4">Ø«Ø¨Øª Ù†Ø§Ù… Ø¯ÙˆØ±Ù‡</h4>

                        <!-- Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡ -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ:</label>
                            <div class="d-flex flex-wrap gap-2">
                                {% for x in days %}
                                    <button type="button" class="btn day-btn rounded-pill px-3"
                                            data-id="{{ x.id }}">{{ x.title }}</button>

                                {% endfor %}
                            </div>
                        </div>

                        <!-- ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª Ø¯Ø± Ù…Ø§Ù‡:</label>
                            <div class="d-flex flex-wrap gap-2">
                                {% for x in session %}
                                    <button type="button" class="btn session-btn rounded-pill px-3"
                                            data-id="{{ x.id }}">{{ x.number }} Ø¬Ù„Ø³Ù‡
                                    </button>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ -->
                        <div class="mb-3">
                            <label for="start-date" class="form-label fw-bold">ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹:</label>

                            <div class="calendar-wrapper">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <button id="prevMonth" class="btn btn-cta"><i class="fa fa-chevron-right"></i>
                                    </button>
                                    <h5 id="monthTitle" class="text-center fw-bold m-0"></h5>
                                    <button id="nextMonth" class="btn btn-cta"><i class="fa fa-chevron-left"></i>
                                    </button>
                                </div>

                                <!-- Ø³Ø±ØªÛŒØªØ± Ø§ÛŒØ§Ù… Ù‡ÙØªÙ‡ -->
                                <div class="calendar-grid text-center fw-bold border-bottom pb-2">
                                    <div>Ø´</div>
                                    <div>ÛŒ</div>
                                    <div>Ø¯</div>
                                    <div>Ø³</div>
                                    <div>Ú†</div>
                                    <div>Ù¾</div>
                                    <div>Ø¬</div>
                                </div>

                                <!-- Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù‡ -->
                                <div id="calendarDays" class="calendar-grid mt-2">
                                    <!-- Ù„ÙˆØ¯ Ù…ÛŒØ´Ù‡ Ø§Ø² JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </section>

    <section class="course-description py-5">
        <div class="container px-lg-5">
            <h4 class="fw-bold mb-4">ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯ÙˆØ±Ù‡</h4>

            <div class="description-box p-4 shadow-sm rounded">
                {% autoescape off %}
                    {{ product.description|linebreaksbr }}
                {% endautoescape %}
            </div>
        </div>
    </section>


    <script>

        let sessionId = 0;
        let dayId = 0;
        let currentDayId = 0;

        document.querySelectorAll('.day-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                dayId = btn.getAttribute("data-id");  // âœ… Ø§ÛŒÙ†Ø¬ÙˆØ±ÛŒ ID Ø±Ùˆ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ
            });
        });

        document.querySelectorAll('.session-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.session-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                sessionId = btn.getAttribute("data-id");  // âœ… Ø§ÛŒÙ†Ù… Ø¨Ø±Ø§ÛŒ Ø¬Ù„Ø³Ù‡
            });
        });


    </script>



    <script>
        const apiBase = '/calendar'; // ÙØ±Ø¶ Ú©Ù† Ø¢Ø¯Ø±Ø³ API Ø§ÛŒÙ†Ù‡
        let currentMonthId = null;

        function loadMonth(monthId) {
            fetch(`${apiBase}/months/${monthId}/`)
                .then(res => res.json())
                .then(month => {
                    currentMonthId = month.id;
                    document.getElementById("monthTitle").innerText = `${month.name} ${month.year.number}`;

                    const daysContainer = document.getElementById("calendarDays");
                    daysContainer.innerHTML = "";

                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø§ÙˆÙ„ Ù…Ø§Ù‡
                    const dayNames = ['Ø´Ù†Ø¨Ù‡', 'ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡ â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡'];
                    const startIndex = dayNames.indexOf(month.startDay);
                    for (let i = 0; i < startIndex; i++) {
                        daysContainer.innerHTML += `<div class="col calendar-day"></div>`;
                    }

                    month.days.forEach(day => {
                        const classes = ["calendar-day"];
                        if (day.holiday) classes.push("holiday");
                        if (day.today) classes.push("today");

                        daysContainer.innerHTML += `
      <div class="${classes.join(" ")}" data-id="${day.id}" title="${day.description || ''}">
        ${day.number}
      </div>`;
                    });

                });
        }

        // Navigation
        document.getElementById("prevMonth").addEventListener("click", () => {
            fetch(`${apiBase}/months/${currentMonthId}/prev/`).then(res => res.json()).then(m => loadMonth(m.id));
        });
        document.getElementById("nextMonth").addEventListener("click", () => {
            fetch(`${apiBase}/months/${currentMonthId}/next/`).then(res => res.json()).then(m => loadMonth(m.id));
        });

        // First load
        window.onload = () => {
            fetch(`${apiBase}/months/current/`).then(res => res.json()).then(m => loadMonth(m.id));
        };


        document.addEventListener('click', function (e) {
            const dayEl = e.target.closest('.calendar-day');
            if (dayEl) {
                // Ø§ÙˆÙ„ Ù‡Ù…Ù‡ Ø±ÙˆØ²Ù‡Ø§ Ø§Ø² Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¯Ø±Ù…ÛŒØ§Ø¯
                document.querySelectorAll('.calendar-day').forEach(el => {
                    el.classList.remove('selected-day');
                });

                // ÙÙ‚Ø· Ù‡Ù…ÙˆÙ†ÛŒ Ú©Ù‡ Ú©Ù„ÛŒÚ© Ø´Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒØ´Ù‡
                dayEl.classList.add('selected-day');
            }
        });

        document.addEventListener("click", function (e) {
            if (e.target.classList.contains("calendar-day") && !e.target.classList.contains("holiday") && !e.target.classList.contains("past")) {
                document.querySelectorAll(".calendar-day").forEach(d => d.classList.remove("selected-day"));
                e.target.classList.add("selected-day");

                currentDayId = e.target.getAttribute("data-id");  // âœ… Ø¢ÛŒØ¯ÛŒ Ø±ÙˆØ² ØªÙ‚ÙˆÛŒÙ…
            }
        });


    </script>


    <script>

        let course = "{{ product.id }}";

        document.addEventListener("DOMContentLoaded", function () {

            document.getElementById("registerBtn").addEventListener("click", function (event) {
                event.preventDefault(); // Ø¬Ù„ÙˆÛŒ Ø±ÙØªÙ† Ø¨Ù‡ Ù„ÛŒÙ†Ú© Ø±Ùˆ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡

                registerUser(); // ğŸ‘ˆ Ù…Ø«Ù„Ø§ ÛŒÙ‡ ÙØ§Ù†Ú©Ø´Ù†ÛŒ Ú©Ù‡ ØªØ¹Ø±ÛŒÙ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ
            });

            function registerUser() {
                if (sessionId !== 0 && dayId !== 0) {
                    window.location.assign(`/product/payment/${course}/${sessionId}/${dayId}/${currentDayId}`)
                } else if (sessionId === 0) {
                    alert("Ù„Ø·ÙØ§ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª Ø¯Ø± Ù…Ø§Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯")
                } else if (dayId === 0) {
                    alert("Ù„Ø·ÙØ§ Ø±ÙˆØ² Ù‡Ø§ÛŒ Ø¨Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø¯Ø± Ù‡ÙØªÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯")
                } else if (currentDayId === 0) {
                    alert("Ù„Ø·ÙØ§ ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ±Ù‡ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯")
                } else {
                    alert("ØªÙ…Ø§Ù…ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")
                }
            }
        });

    </script>


{% endblock %}


</body>
</html>

